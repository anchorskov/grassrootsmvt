# ============================
# üåê Cloudflare Worker Config
# grassrootsmvt
# ============================

name = "grassrootsmvt"
main = "src/index.js"
account_id = "8bfd3f60fbdcc89183e9e312fb03e86e"
compatibility_date = "2025-10-01"
compatibility_flags = ["nodejs_compat"]
workers_dev = true

[assets]
directory = "../ui"   # serve UI/static from Worker

# ===== LOCAL (default) =====
[[d1_databases]]
binding = "d1"
database_name = "wy_local"
database_id = "de78cb41-176d-40e8-bd3b-e053e347ac3f"
migrations_dir = "db/migrations"

[vars]
ENVIRONMENT = "local"
DATA_BACKEND = "d1"
ALLOW_ORIGIN_DEV = "http://127.0.0.1:8788,http://localhost:8788,http://localhost:5173"
ADMIN_EMAILS = "dev@localhost,admin@grassrootsmvt.org"

# ===== PREVIEW =====
[env.preview]
name = "grassrootsmvt-api-preview"

[env.preview.vars]
ENVIRONMENT = "preview"
DATA_BACKEND = "d1"
ALLOW_ORIGIN_DEV = "https://preview.grassrootsmvt.org"

[[env.preview.d1_databases]]
binding = "d1"
database_name = "wy_local"
database_id = "de78cb41-176d-40e8-bd3b-e053e347ac3f"
migrations_dir = "db/migrations"

# ===== PRODUCTION =====
[env.production]
name = "grassrootsmvt"

[env.production.vars]
ENVIRONMENT = "production"
DATA_BACKEND = "d1"
PUBLIC_HOSTNAME = "volunteers.grassrootsmvt.org"

# Route ALL requests (UI + API) to this Worker
routes = [
  { pattern = "volunteers.grassrootsmvt.org/*", zone_name = "grassrootsmvt.org" }
]

[[env.production.d1_databases]]
binding = "d1"
database_name = "wy"
database_id = "4b4227f1-bf30-4fcf-8a08-6967b536a5ab"
migrations_dir = "db/migrations"
